<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- 중요 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" th:href="@{/css/example-min.css}" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js" ></script>

</head>
<body>
<header>
    <nav th:replace="~{top_menu :: top_menu}"></nav>
</header>
<h2>채팅방</h2>
<h5>messages_history</h5>
<ul id="chat">
    <li th:each="msg : ${messages_history}" th:text="${msg.wdate + ': ' + msg.sender + ': ' + msg.message}"></li>
</ul>
sender:<input type="text" id="sender" placeholder="닉네임" value="yangssem"/><br>
message<input type="text" id="message" placeholder="메시지" value="Hello Chat"/>
<button onclick="sendMessage()">전송</button>
<div class="message full"></div>
<script>
    const log_div = function ( msg ) {
        let objectDate = new Date();

        let day = objectDate.getDate();
        let month = objectDate.getMonth()+1;
        let year = objectDate.getFullYear();
        console.log(year);
        $('.message').append('<div>[' +year+'-'+month+ '-' +day+' '+new Date().toLocaleTimeString() + '] ' +  msg + '</div>' );
    }

    let room_id = '[[${room_id}]]';
    console.log(room_id);
    let ws = new WebSocket("ws://172.30.1.13:8821/ws/chat?room_id=" + room_id);

    ws.onopen = function( evt ) {
        log_div( '서버와 연결하였습니다.' );
    };



    ws.onmessage = function(event) {
        console.log("onmessage - event.data : ",event.data);
        log_div( event.data);
    };

    function sendMessage() {
        const sender = $("#sender").val();
        const message = $("#message").val();
        console.log( sender + ": " + message );
        const obj_message = {
            room_id: room_id,
            sender: sender,
            message: message
        };
        ws.send(JSON.stringify(obj_message));
    }
</script>
</body>
</html>
